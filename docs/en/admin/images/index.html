<!DOCTYPE html>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Pragma" content="no-cache">
	
	<link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/img/favicon.ico" type="image/x-icon">
	<title>Eutopía - Ecocenter</title>
	<link rel="stylesheet" type="text/css" href="/libs/noty.min.css">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="/styles.css">
</head>
<body>
	<div class="app">
		
		<div class="adminLayout">
			<div class="adminSidebar">
				<header >
					<a class="brand" href="/en">
						<img src="/uploads/images/euto-logo-trans.png" />
					</a>
					<nav class="headerNav">
						
					</nav>
				</header>
				<div class="blockChilds form developmentPage adminNav admin protected" style="display: none;">
				    <a class="backBtn" href="/" target="_blank">Abrir pagina en una nueva pestaña.</a>
				    <div>
				        <p class="italic fnt-12" style="margin-top:5px">
				            <span>Pagina actualizada el <span v-html="deployedAt"></span></span>
				        </p>
				    </div>
				    <div>
				        <button class="btn" v-cloak v-if="true" @click="(loaders.deploy||isCooldown('deploy'))||deploy()" :disabled="loaders.deploy||isCooldown('deploy')" v-html="loaders.deploy?'Publicando...':'Publicar cambios'"></button>
				        <p class="italic fnt-12" style="margin-top:5px" v-show="isCooldown('deploy')">
				            Cambios publicados recientemente, espera un momento...
				        </p>
				    </div>
				    <!--
				    
				    <div>
				        <button class="btn" v-cloak v-if="true" @click="loaders.wipMode||(isCooldown('wipMode'))||deployWipMode()" :disabled="loaders.wipMode||isCooldown('wipMode')" v-html="loaders.wipMode?'Procesando...':'Actualizar sitio con mensaje indicando que estamos trabajando en la pagina'"></button>
				        <p class="italic fnt-12" style="margin-top:5px" v-show="isCooldown('wipMode')">
				            Cambios publicados recientemente, espera un momento...
				        </p>
				    </div>
				    <p class="fnt-12 italic">Al publicar, el sitio toma entre uno y dos minutos en actualizarse. Una vez pasado este tiempo tenemos que refrescar el navegador manualmente. Si los cambios no aparecen, intentar refrescar el navegador pulsando CTRL+R en reiteradas ocaciones.</p>
				-->
				    <div class="sidebarMenu">
				
				    <a href="/admin/programacion">
				            <i class="fas fa-calendar-alt"></i>
				            Programacion
				        </a>
				    <a href="/admin/voluntarios">
				            <i class="fas fa-people-carry"></i>
				            Voluntarios
				        </a>
				    <a href="/admin/formulario-de-contacto">
				            <i class="fas fa-phone-volume"></i>
				            Contactos
				        </a>
				    <a href="/admin/images">
				            <i class="fas fa-images"></i>
				            Imagenes 
				        </a>
				    <a href="/admin/files">
				            <i class="fas fa-file"></i>
				            Archivos
				        </a>
				    <a href="/admin/pages">
				            <i class="fas fa-book"></i>
				            Paginas
				        </a>
				    <a href="/admin/partials">
				            <i class="fas fa-boxes"></i>
				            Vistas parciales
				        </a>
				
				<a href="/admin/styles">
				            <i class="fas fa-cookie-bite"></i>
				            Estilos CSS
				        </a>
				
				    <a href="/admin/changelog">
				            <i class="fas fa-clipboard-list"></i>
				            Historial de cambios
				        </a>
				    <a href="/admin/faq">
				            <i class="fas fa-book"></i>
				            Documentacion
				        </a>
				    <a href="/admin/avanzado">
				        <i class="fas fa-cogs"></i>
				        Configuracion avanzada</a>
				    <a @click="logout()" class="logout">
				
				        Desconectarse</a>
				        </div>
				</div>
			</div>
			<div class="adminMainContent">
				<div class="mainContent">
					<section class="admin protected container appScope">
					    <h3>Imagenes</h3>
					    <label class="important">Subir imagenes</label>
					    <section class="upload-images">
					        <div class="developmentPage">
					            <input type="file" name="image" id="image" />
					            <button class="btn" @click="uploadImage()" v-html="loaders.imageUpload?'Espera...':'Subir'"></button>
					        </div>
					    </section>
					    <label class="important">Galeria</label>
					    <section class="view-images imagesViewBox">
					        <div class="developmentPage">
					            <div v-for="item in images" class="adminImageItem">
					                <a :href="`${item.link}`" target="_blank">
					                    <div class="admin-image-thumb" :style="`background-image:url(${item.link});`">
					                    </div>
					                    </a>
					                <input :value="`/uploads/images/${item.name}`" class="imageUrl adminImageItemUrl" />
					                <p class="fnt-12 italic text-center" v-show="item.pending">Requiere publicar cambios</p>
					                <div >
					                                <button :disabled="loaders.removingImage" @click="loaders.removingImage || removeImage(item.name)" class="btn danger mx-auto"><i class="fas fa-trash-alt"></i></button>
					                            </div>
					            </div>
					        </div>
					    </section>
					</section>				</div>
			</div>
		</div>
		
		
		
	</div>
	<script type="text/javascript" src="/js/common-admin.js"></script>
	<script type="text/javascript">
		window.vues = {};
		window.SERVER={
			API_URL: 'https://utopiaecoaldea.herokuapp.com',
			currentPage: 'page_admin_images',
	currentLanguage: 'English',
			defaultCurrentPage:'page_ecoaldea',
			updateCode:'ZYBnt9si1',
			wipMode: 'false',
			lang: JSON.parse(`{"COMO_FUNCIONA":"Necesitas agregar una propiedad (object key) por acada idioma.","PRODUCTOS_CATALOGO_TITULO":"Nuestra aldea tambien produce una variedad de productos organicos y buenos para la salud!","PRODUCTOS_CATALOGO_BOTON_DESCARGA":"Descarga nuestro catalogo","CONOCER_FERIA":"Conoce nuestra feria","VOLUNTARIADO_FORM_TITLE":"Solicitud","DESCARGA_PROPUESTA":"Descarga nuestra propuesta","ACTUALIDADES":"News","VOLUNTARIADO_ENVIAR_SOLICITUD_ERROR":"Sorry, we could not register your application. Please, try again later or send us an email with your information. Thank you !","VOLUNTARIADO_ENVIAR_SOLICITUD_SUCCESS":"Thank you for your application ! We will contact you soon :)","PROGRAMACION":"Programation","ENVIAR":"Send","TELEFONO":"Phone","MENSAJE":"Message","EMAIL":"Email","NOMBRE_APELLIDO":"Name and surname","HEADER_MESSAGE":"Enjoy the experience of nature","FERIAS_PRODUCTORES":"Local products market","NUESTROS_PRODUCTOS":"Our products","PRODUCTOS_FERIAS":"Products and fairs","PRODUCTOS_FERIAS_INTRO":"Organic and local products fair ! Come to our eco-center to discover local producers who respect nature, try their delicious products and enjoy being in the countryside, surrounded by nature !","FERIAS_PRODUCTORES_CONTENT_1":"We are engaged in helping local producers to sell their production for a fair price to the local market, to offer the best of our local products to the inhabitants of Chiclayo and the nearby areas. <br> One in two week-end, we organize a fair with all the producers where we sell a large diversity of local products.<br> You will find honey, yogurt, cheese, fruits, vegetables, fresh drinks, all natural and organic !","FERIAS_PRODUCTORES_CONTENT_2":"Come and visit us for the fairs and enjoy our eco-center to spend a family day away from the city !","FERIAS_PRODUCTORES_CONTENT_3":"We offer all the facilities for you to have a great day : playground, swimming pool, relaxing area, reading area.<br>                    Eco-restaurant with fresh ecological product homecooked.<br>                    Workshops to learn and discover at any age about permaculture, crops, ceramic, painting, or to practice meditation, yoga, or Tai-chi !<br>                    Visits with explainations about our garden, plant nursery, compost and waste treatment area.<br>                    Stage with live music and a diversity of shows (see our programation)<br>                    Camping zone<br>                    And much more ! !","PROFESIONALES":"Companies","FAMILIAS":"Families","ESCUELAS":"Schools","ADULTOS":"Care centers for elderly people","pr":"Portuguese","it":"Italian","de":"German","fr":"French","en":"English","es":"Spanish","IDIOMAS":"Language","GRUPOS":"Groups","GRUPOS_INTRO":"Families, schools, companies, organize your events in our eco-center !","GRUPOS_CONTENT_1":"We offer a large range of activities, visits, workshops to create on-demand events customized just for you ! Always looking forward to share experiences, learn and enjoy the nature for unforgettable moments !","ESCUELAS_1":"We guide your students through the creation of a plant nursery, a garden and a waste treatment area for you school !","ADULTOS_1":"We help you improve the well being of the elderly. We offer a full relaxing days of activities in the nature to learn and share knowledge about permaculture and the plants that help us keep a good health ! ","EMPRESAS_1":"We organize your seminars or celebrations in our eco-center to offer your employees a unique souvenir of these important moments ! Team building, focus on the present moment, in total desconnection with the day to day stress and routine.","FAMILIAS_1":"Come and enjoy a unique week-end in the nature, with activities and learnings for all the family, disconnected from the day to day life and the city ! Ideal to celebrate birthdays, graduation, anniversaries !","HEADER_HOME_LABEL":"Discover","HOME_INTRO":"Visit and enjoy our eco-center every week-end !","HOME_CONTENT_1":"Our eco-center in the nature is opened every week-end so that you can enjoy being in the countryside, in a place where you can have fun and relax with activities for all the family !","HOME_CONTENT_2":"playground, swimming pool, relaxing area, reading area.<br>                    Eco-restaurant with fresh ecological product homecooked.<br>                    Workshops to learn and discover at any age about permaculture, crops, ceramic, painting, or to practice meditation, yoga, or Tai-chi !<br>                    Visits with explainations about our garden, plant nursery, compost and waste treatment area.<br>                    Stage with live music and a diversity of shows (see our programation)<br>                    Camping zone<br>                    And much more ! !","HOME_CONTENT_3":"We are opened for the visitors from saturday to sunday, from 9am to 6pm","ECOALDEA":"Ecocenter","VOLUNTARIADO":"Volonteer","VOLUNTARIADO_CONTENT_1":"Why are you interested in visiting us ?","VOLUNTARIADO_CONTENT_2":"How would you like to help us ? Do you have a project in particular you would like to propose ?","VOLUNTARIADO_CONTENT_3":"When do you plan to come ?","CONTACTO":"Contact","ABOUT_US":"About us","ABOUT_US_CONTENT_1":"We are a group of people who look forward to live in a sustainable way, promoting permaculture, agro ecology, eco pedagogy and healthy life, generating small entrepreneurial projects to finance our activities","MISSION":"Mission","MISSION_CONTENT_1":"Share a place in deep connection with nature, with one-self and the other living beings to create interactions and share one's knowledge and experiences with anyone interested in it","VISION":"Vision","VISION_CONTENT_1":"Be an eco-center self-sustained and recognized for its mission and the diversity of crops, products and services proposed to the comunity ","META_TITLE":"Eutopía - Ecocenter","HOSPEDAJES":"Lodgings","HOSPEDAJES_CONTENT_1":"Our eco-center offers lodging services so that you can spend the night in the nature and make the week-end last longer !","HOSPEDAJES_TITLE_1":"Camping","HOSPEDAJES_CONTENT_2":"With shower, toilets, electricity, fully-equiped kitchen, playground, swimming pool, and many other services and facilities ! 10 soles per tent","HOSPEDAJES_TITLE_2":"Eco-bungalows","HOSPEDAJES_CONTENT_3":"We are building bungalows so that you can spend the week-end in the nature with all the confort of your house ! Opening in February 2019 : Stay tuned !"}`)
		}
	</script>
	<script type="text/javascript" src="/libs/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.21/vue.min.js"></script>
	<script type="text/javascript" src='/libs/vue-components.js'></script>
	
	<script type="text/javascript" src="/libs/moment.js"></script>
	<script type="text/javascript" src="/libs/noty.min.js"></script>
	
	<script type="text/javascript" src="/libs/slider.js"></script>

	<script type="text/javascript">
		window.moment.locale('es');
	</script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.2/ace.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.2/theme-monokai.js"></script>
	
	<script type="text/javascript">
			function init() {
				window.vues=window.vues||{};
				window.vues['main']= new Vue({
					el: '.appScope',
					name: 'adminImages',
					data() {
						return {
							images: [],
							loaders: {
								imageUpload: false,
								removingImage: false
							}
						}
					},
					created() {

					},
					mounted() {
						this.browseImages();


					},
					methods: {
						removeImage,
						uploadImage,
						browseImages,
					}
				})

				function removeImage(name) {
					if (window.confirm('Seguro ?')) {
						this.loaders.removingImage = true;
						apiPost('/api/images/remove', {
							name: name
						}).then(res => {
							this.loaders.removingImage = false;
							if (!res.err) {
								showInfo("Imagen removida !");
								this.browseImages()
							}
						});
					}
				}

				const imagesCheck = (function() {
					const images = {};
					const self = (url, cache = true) => {
						return new Promise((resolve, reject) => {
							if (images[url]) return resolve(images[url]);

							const image = new Image();
							image.src = url;
							image.onload = () => {
								const data = {
									url,
									width: image.width,
									height: image.height
								};
								if (cache) images[url] = data;
								return resolve(data);
							};
							image.onerror = (err) => {
								return reject(err);
							};
						});
					};
					return self;
				})();

				function browseImages() {
					fetch(`${SERVER.API_URL}/api/images/browse`).then(r => r.json().then(async response => {
						
						this.images = await Promise.all(response.images.map(image => {
							return new Promise((resolve,reject)=>{
								return imagesCheck(`/uploads/images/${image.name}`).then(()=>{
									image.link = `/uploads/images/${image.name}`
									image.pending = false;
									resolve(image)
								}).catch(err=>{
									image.pending = true;
									resolve(image)
								})
							})
						}));

						setTimeout(() => {
							$(".adminImageItemUrl").off('click').on("click", function() {
								$(this).select();
							});
						}, 1000);
					}));
				}

				function uploadImage() {
					var data = new FormData();
					var file = $('#image')[0].files[0];
					data.append('singleFile', file);
					this.loaders.imageUpload = true;
					$.ajax({
						url: `${SERVER.API_URL}/api/upload/single`,
						data: data,
						cache: false,
						contentType: false,
						processData: false,
						type: 'POST',
						error: () => {
							this.loaders.imageUpload = false;
							$('#image').val('');
						},
						success: (data) => {
							this.loaders.imageUpload = false;
							$('#image').val('');
							this.browseImages();
							showInfo("Imagen subida !");
						}
					});
				}
			}
			if(!!init){
				window.pageInit = init;
				init();
			}
	</script>
</body>