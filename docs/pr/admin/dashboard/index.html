<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/img/favicon.ico" type="image/x-icon">
	<title>Eutopía - Ecoaldea</title>

	
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">

		
	<link rel="stylesheet" type="text/css" href="/styles.css">
		<script type="text/javascript" src="/js/common-admin.js"></script>
	<script type="text/javascript">
		window.SERVER={
			API_URL: 'https://utopiaecoaldea.herokuapp.com',
			defaultCurrentPage:'page_about_us',
			updateCode:'97ZNZnbEC'
		}
	</script>
</head>
<body>
		<header>
		    <a class="brand" href="/pr">
		    Eutopía - Ecoaldea
		    <img src="/img/logo.webp"/>
			</a>
		    <nav class="headerNav">
		        <ul class="menu">
		            <li><a href="/ecoaldea">Descubrir</a></li>
		            <li>
		                <a href="/pr/grupos">Grupos</a>
		                <ul class="subMenu">
		                    <li>
		                        <a href="/pr/grupos#escuelas">
		                        Escuelas</a></li>
		                    <li>
		                        <a href="/pr/grupos#adultos">
		                        Adultos&nbsp;mayores</a></li>
		                    <li>
		                        <a href="/pr/grupos#familias">
		                        Familias</a></li>
		                    <li>
		                        <a href="/pr/grupos#profesionales">
		                        Profresionales</a></li>
		                </ul>
		            </li>
		            <li>
		                <a href="/pr/productos-y-ferias">
		                        Productos y ferias</a>
		                <!--
		                <ul class="subMenu">
		                    <li>
		                        <a href="/pr/nuestros-productos">Nuestros productos</a>
		                    </li>
		                    <li>
		                        <a href="/pr/ferias-de-productores">
		                            Ferias de productores</a></li>
		                </ul>
		            -->
		            </li>
		            
		            <li>
		                <a href="/pr/hospedajes">
		                    Hospedajes
		                </a>
		            </li>
		        
		            <li class="languageMenuItem">
		                <a >Portugués</a>
		                <ul class="subMenu">
		                    <li><a href="/">Español</a></li>
		                    <li><a href="/en">Ingles</a></li>
		                    <li><a href="/fr">Frances</a></li>
		                    <li><a href="/de">Aleman</a></li>
		                    <li><a href="/pr">Portugués</a></li>
		                </ul>
		            </li>
		        </ul>    </nav>
		</header>
		<section>
		    <div class="image-title centered"
		            style="background-image:url(https://static.wixstatic.com/media/e8020c_9f32e3f33d284c99b541159458c7be48~mv2_d_1920_1280_s_2.jpg/v1/fill/w_699,h_466,al_c,q_90,usm_0.66_1.00_0.01/e8020c_9f32e3f33d284c99b541159458c7be48~mv2_d_1920_1280_s_2.webp);"
		            >
		        <h2>Vive la experiencia de la naturaleza</h2>            
		    </div>
		</section>		<!--
		<section class="admin_header">
	        <h3 class="brand">
	        <a href="/">Eutopía - Ecoaldea</a>
	         - Admin</h3>
	        <hr>
	    </section>
	-->

	<div class="mainContent">
		<section class="admin protected">
		    <section class="admin_menu">
		
		        <a @click="()=>collapsables.deploy=true">Estado del sitio</a>
		        <section v-show="collapsables.deploy">
		            <label>Pagina actualizada el <span v-html="deployedAt"></span></label>
		            <button class="btn" v-cloak v-if="true" @click="(uploading||waitingUpdate)||deploy()" :disabled="uploading||waitingUpdate" v-html="uploading?'Publicando...':'Publicar cambios recientes'"></button>
		        </section>
		        
		        <a @click="()=>collapsables.upload_image=!collapsables.upload_image">General: Subir imagenes</a>
		        <section class="upload-images" v-show="collapsables.upload_image">
		            <input type="file" name="image" id="image"/>
		            <button class="btn" @click="uploadImage()" v-html="uploading?'Wait':'Upload'"></button>
		        </section>
		        <a @click="()=>collapsables.view_images=!collapsables.view_images">General: Ver imagenes</a>
		        <section class="view-images imagesViewBox" v-show="collapsables.view_images">
		            <div v-for="item in images">
		                <div class="admin-image-thumb" 
		                :style="`background-image:url(/uploads/images/${item});`">
		                </div>
		                <input :value="`/uploads/images/${item}`" class="imageUrl"/>
		            </div>
		        </section>
		
		        <a @click="()=>collapsables.parameters=!collapsables.parameters">General: Parametros (Avanzado)</a>
		        <section v-show="collapsables.parameters">
		            <parameters type="data" :enabled="collapsables.parameters"></parameters>
		            <parameters type="locales" :enabled="collapsables.parameters"></parameters>
		        </section>
		
		        
		        
		
		        <!--
		        <a href="#">Hospedajes: Titulo: Color</a>
		        <a href="#">Hospedajes: Titulo: Texto</a>
		        <a href="#">Hospedajes: Titulo: Imagen</a>
		        <a href="#" onclick="logout()" class="logout">Salir</a>
		        <hr>-->
		    </section>
		</section>	</div>

		<nav class="footerNav">
		    <hr>
		        <ul class="menu">
		            <li><a href="/ecoaldea">Descubrir</a></li>
		            <li>
		                <a href="/pr/grupos">Grupos</a>
		                <ul class="subMenu">
		                    <li>
		                        <a href="/pr/grupos#escuelas">
		                        Escuelas</a></li>
		                    <li>
		                        <a href="/pr/grupos#adultos">
		                        Adultos&nbsp;mayores</a></li>
		                    <li>
		                        <a href="/pr/grupos#familias">
		                        Familias</a></li>
		                    <li>
		                        <a href="/pr/grupos#profesionales">
		                        Profresionales</a></li>
		                </ul>
		            </li>
		            <li>
		                <a href="/pr/productos-y-ferias">
		                        Productos y ferias</a>
		                <!--
		                <ul class="subMenu">
		                    <li>
		                        <a href="/pr/nuestros-productos">Nuestros productos</a>
		                    </li>
		                    <li>
		                        <a href="/pr/ferias-de-productores">
		                            Ferias de productores</a></li>
		                </ul>
		            -->
		            </li>
		            
		            <li>
		                <a href="/pr/hospedajes">
		                    Hospedajes
		                </a>
		            </li>
		        
		            <li class="languageMenuItem">
		                <a >Portugués</a>
		                <ul class="subMenu">
		                    <li><a href="/">Español</a></li>
		                    <li><a href="/en">Ingles</a></li>
		                    <li><a href="/fr">Frances</a></li>
		                    <li><a href="/de">Aleman</a></li>
		                    <li><a href="/pr">Portugués</a></li>
		                </ul>
		            </li>
		        </ul></nav>
		<footer>
		    <ul class="menu">
		        
		        <li><a href="/pr/sobre-nos">Sobre nós</a></li>
		    
		        <li><a href="/pr/entre-em-contato">Entre em contato</a></li>
		        <!--
		        <li><a href="/pr/voluntariado">Voluntariado</a></li>
		    -->
		        <li class="socialIcons">
		        	<a href="https://web.facebook.com/Eutopia-Ecoaldea-401715843328614/?_rdc=1&_rdr" target="_blank">
		        		<i class="fab fa-facebook"></i>
		        	</a>
		            <a href="http://instagram.com/eutopiaecoaldea" target="_blank">
		                <i class="fab fa-instagram"></i>
		            </a>
		        </li>
		        
		    </ul>
		</footer>
	<script type="text/javascript" src="/libs/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="/libs/vue.js"></script>
	<script type="text/javascript" src="/libs/moment.js"></script>

		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.2/ace.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.2/theme-monokai.js"></script>

	<!--
	<script type="text/javascript" src="/bundle.js"></script>
-->
	<script type="text/javascript">
			function init() {

				Vue.component('parameters', {
					props: ['enabled', "type"],
					template: `<div  class="parameters-component">
						<codemirror :enabled="enabled" v-model="data"></codemirror>
						<button class="btn" @click="saveParameters" v-html="progress?'Guardando...':'Guardar'"></button>
					</div>`,
					data() {
						return {
							data: '',
							progress: false
						}
					},
					created() {
						var url = ({
							data: 'config/fetch',
							locales: 'locales/fetch'
						})[this.type || 'data']
						fetch(`${SERVER.API_URL}/api/${url}`).then(r => r.json().then(response => {
							this.data = response.result;
						}));
					},
					mounted() {

					},
					methods: {
						saveParameters() {
							this.progress = true;
							var path = ({
								data: 'config/data.js',
								locales: 'config/locales.js'
							})[this.type || 'data']
							$.ajax({
								url: `${SERVER.API_URL}/api/git/path`,
								data: JSON.stringify({
									files: [{
										contents: this.data,
										path: path
									}],
									path: path
								}),
								contentType: "application/json; charset=utf-8",
								type: 'POST',
								error: () => {
									this.progress = false;
									console.warn('NOT SAVED')
								},
								success: (data) => {
									this.progress = false;
									console.log('SAVED')
								}
							});
						}

					}
				});

				Vue.component('codemirror', {
					props: ['value', 'enabled'],
					template: `<div  class="codemirror-component">
						<div ref="editor" style="width: -webkit-fill-available;height: 300px;"></div>
					</div>`,
					data() {
						return {
							editor: null,
							init: false,
							activated: false
						}
					},
					watch: {
						value() {
							if (!!this.editor && !this.init) {
								this.editor.setValue(this.value, -1);
								this.init = true;
							}
						},
						enabled() {
							if (this.enabled === true && !this.activated) {
								this.activate();
							}
						}
					},
					methods: {
						activate() {
							if (this.activated) return;
							this.activated = true;
							var editor = ace.edit(this.$refs.editor);
							editor.setTheme("ace/theme/monokai");
							editor.session.setMode("ace/mode/javascript");
							this.editor = editor;
							this.editor.on('change', () => {
								var value = this.editor.getValue();
								console.log('change', value);
								this.$emit('input', value);
							});
							if (!!this.value) {
								this.editor.setValue(this.value, -1);
							}
						}
					},
					mounted() {
						if (this.enabled || this.enabled === undefined) {
							this.activate();
						}
					}
				});

				new Vue({
					el: '.admin',
					name: 'admin_dashboard',
					data() {
						return {
							waitingUpdate: false,
							uploading: false,
							single_image: null,
							images: [],
							deployedAt: '',
							collapsables: {
								upload_image: false,
								view_images: false,
								parameters: false,
								deploy: true
							}
						}
					},
					created() {
						fetch(`/manifest.json`).then(r => r.json().then(response => {
							this.deployedAt = moment(response.created_at, 'x').format('DD-MM-YY HH:mm');
						}));

						var updateCode = window.localStorage.getItem('updateCode');
						if (!!updateCode) {
							if (SERVER.updateCode != updateCode) {
								this.waitingUpdate = true;
							} else {
								window.localStorage.setItem('updateCode', '')
							}
						}



					},
					mounted() {
						this.browseImages();
					},
					methods: {

						deploy,
						uploadImage,
						browseImages
					}
				})

				function deploy() {
					this.uploading = true;
					fetch(`${SERVER.API_URL}/api/deployment/publish`).then(r => r.json().then(response => {
						window.localStorage.setItem('updateCode', response.updateCode);
						window.localStorage.setItem('updateCodeDate', Date.now());
						this.waitingUpdate = true;
						this.uploading = false;
						console.info('updateCode', response.updateCode)
					}));
				}

				function browseImages() {
					fetch(`${SERVER.API_URL}/api/images/browse`).then(r => r.json().then(response => {
						this.images = response.images;
					}));
				}

				function uploadImage() {
					var data = new FormData();
					var file = $('#image')[0].files[0];
					data.append('image', file);
					this.uploading = true;
					$.ajax({
						url: `${SERVER.API_URL}/api/upload/images/single`,
						data: data,
						cache: false,
						contentType: false,
						processData: false,
						type: 'POST',
						error: () => {
							this.uploading = false;
							$('#image').val('');
						},
						success: (data) => {
							this.uploading = false;
							$('#image').val('');
							alert('Image uploaded!')
						}
					});
				}
			}
			if(!!init){
				init();
			}
	</script>
</body>